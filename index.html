<!-- ... everything above remains unchanged ... -->
    <div id="boardSection" class="hidden section">
      <h2>자유 게시판</h2>
      <!-- New Post Form -->
      <form id="newPostForm" onsubmit="return addBoardPost(event)">
        <div style="margin-bottom:8px;">
          <label>
            <input type="radio" name="postAnon" id="postAnonYes" value="yes" checked>
            익명
          </label>
          <label style="margin-left:12px;">
            <input type="radio" name="postAnon" id="postAnonNo" value="no">
            이름/닉네임
          </label>
          <input type="text" id="postName" placeholder="이름 또는 닉네임" style="display:none; margin-left:10px;">
        </div>
        <input type="text" id="postTitle" placeholder="제목" required>
        <textarea id="postBody" placeholder="내용" required></textarea>
        <div style="margin-bottom:8px;">
          <label>사진 첨부 (최대 5장): 
            <input type="file" id="postImages" accept="image/*" multiple>
          </label>
          <div id="imagePreview" style="margin-top:6px; display:flex; gap:5px; flex-wrap:wrap;"></div>
        </div>
        <input type="submit" value="게시">
      </form>
      <!-- Post List -->
      <div id="boardList"></div>
      <div id="pagination" style="text-align:center; margin:10px 0;"></div>
      <!-- Post Details Modal -->
      <div id="postModal" class="hidden" style="position:fixed;left:0;top:0;width:100vw;height:100vh;background:#0008;z-index:20;display:flex;align-items:center;justify-content:center;">
        <div style="background:#fff7f0;max-width:430px;width:95vw;padding:17px 7px 17px 17px;border-radius:14px;position:relative;">
          <button style="position:absolute;top:7px;right:10px;font-size:1.15em;background:none;border:none;color:#f4978e;cursor:pointer;" onclick="closePostModal()">✖</button>
          <h3 id="modalTitle"></h3>
          <div style="font-size:.93em;color:#f4978e;" id="modalName"></div>
          <div id="modalImages" style="margin:8px 0;display:flex;flex-wrap:wrap;gap:5px;"></div>
          <div style="margin:10px 0 20px 0;white-space:pre-line;" id="modalBody"></div>
          <hr>
          <h4>댓글</h4>
          <div id="commentList"></div>
          <form id="commentForm" onsubmit="return addComment(event)">
            <div style="margin-bottom:8px;">
              <label>
                <input type="radio" name="commentAnon" id="commentAnonYes" value="yes" checked>
                익명
              </label>
              <label style="margin-left:12px;">
                <input type="radio" name="commentAnon" id="commentAnonNo" value="no">
                이름/닉네임
              </label>
              <input type="text" id="commentName" placeholder="이름 또는 닉네임" style="display:none; margin-left:10px;">
            </div>
            <textarea id="commentBody" placeholder="댓글 내용" required></textarea>
            <input type="submit" value="댓글 등록">
          </form>
        </div>
      </div>
    </div>
<!-- ... everything after remains unchanged ... -->

<script>
// ========== 자유 게시판 기능 개선 ==========
// Utility for localStorage
function getBoardPosts() {
  return JSON.parse(localStorage.getItem('boardPosts') || '[]');
}
function saveBoardPosts(posts) {
  localStorage.setItem('boardPosts', JSON.stringify(posts));
}

// Name/Nickname input Show/Hide for post/comment
document.getElementById('postAnonYes').addEventListener('change', function() {
  document.getElementById('postName').style.display = 'none';
});
document.getElementById('postAnonNo').addEventListener('change', function() {
  document.getElementById('postName').style.display = 'inline-block';
});
document.getElementById('commentAnonYes').addEventListener('change', function() {
  document.getElementById('commentName').style.display = 'none';
});
document.getElementById('commentAnonNo').addEventListener('change', function() {
  document.getElementById('commentName').style.display = 'inline-block';
});

// Image preview for post
document.getElementById('postImages').addEventListener('change', function(event) {
  const files = Array.from(event.target.files).slice(0,5);
  const preview = document.getElementById('imagePreview');
  preview.innerHTML = '';
  files.forEach(file => {
    if(!file.type.startsWith('image/')) return;
    const reader = new FileReader();
    reader.onload = function(e) {
      const img = document.createElement('img');
      img.src = e.target.result;
      img.style.width = '50px';
      img.style.height = '50px';
      img.style.objectFit = 'cover';
      img.style.borderRadius = '6px';
      preview.appendChild(img);
    };
    reader.readAsDataURL(file);
  });
});

// Add new post
function addBoardPost(event) {
  event.preventDefault();
  const anon = document.querySelector('input[name="postAnon"]:checked').value === 'yes';
  const name = anon ? '익명' : document.getElementById('postName').value.trim() || '익명';
  const title = document.getElementById('postTitle').value.trim();
  const body = document.getElementById('postBody').value.trim();
  const files = Array.from(document.getElementById('postImages').files).slice(0,5);

  if (!title || !body) return false;
  if (!anon && !document.getElementById('postName').value.trim()) {
    alert('이름 또는 닉네임을 입력하세요.');
    return false;
  }

  let imgPromises = files.map(file => new Promise(resolve => {
    const reader = new FileReader();
    reader.onload = e => resolve(e.target.result);
    reader.readAsDataURL(file);
  }));

  Promise.all(imgPromises).then(imgDataURLs => {
    const posts = getBoardPosts();
    const post = {
      id: Date.now(),
      name,
      title,
      body,
      images: imgDataURLs,
      comments: [],
      time: new Date().toISOString()
    };
    posts.unshift(post);
    saveBoardPosts(posts);
    event.target.reset();
    document.getElementById('postName').style.display = 'none';
    document.getElementById('imagePreview').innerHTML = '';
    renderBoardList(1);
  });
  return false;
}

// Pagination & List
let boardCurrentPage = 1;
function renderBoardList(page=1) {
  const posts = getBoardPosts();
  const perPage = 5;
  const totalPages = Math.ceil(posts.length / perPage) || 1;
  boardCurrentPage = Math.max(1, Math.min(page, totalPages));
  const start = (boardCurrentPage-1)*perPage;
  const paginated = posts.slice(start, start+perPage);

  let html = "";
  if(!paginated.length) html = "<div style='text-align:center;color:#aaa;'>게시글이 없습니다.</div>";
  else html = "<ul style='list-style:none;padding:0'>";
  paginated.forEach((post, idx) => {
    html += `<li style="border-bottom:1px solid #f4978e22;padding:9px 0;cursor:pointer;" onclick="openPostModal(${post.id})">
      <strong style="font-size:1.05em;">${post.title}</strong>
      <span style="color:#f4978e;margin-left:7px;font-size:.98em;">${post.name}</span>
      <div style="font-size:.92em; color:#888; margin-top:2px; white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:90%;">
        ${post.body.length > 50 ? post.body.substring(0,50)+'...' : post.body}
      </div>
    </li>`;
  });
  html += "</ul>";
  document.getElementById('boardList').innerHTML = html;

  // Pagination
  let phtml = '';
  for(let i=1;i<=totalPages;i++) {
    phtml += `<button style="margin:0 3px;padding:2px 8px;border-radius:5px;border:none;background:${i===boardCurrentPage?'#f4978e':'#f9c5b5'};color:#fff;" onclick="renderBoardList(${i})">${i}</button>`;
  }
  document.getElementById('pagination').innerHTML = phtml;
}
window.renderBoardList = renderBoardList;

// Open Post Modal
let currentPostId = null;
function openPostModal(postId) {
  const posts = getBoardPosts();
  const post = posts.find(p=>p.id===postId);
  if(!post) return;
  currentPostId = postId;
  document.getElementById('modalTitle').textContent = post.title;
  document.getElementById('modalName').textContent = post.name;
  document.getElementById('modalBody').textContent = post.body;
  // Images
  const modalImgs = document.getElementById('modalImages');
  modalImgs.innerHTML = '';
  (post.images || []).forEach(url=>{
    const img = document.createElement('img');
    img.src = url;
    img.style.width = '70px';
    img.style.height = '70px';
    img.style.objectFit = 'cover';
    img.style.borderRadius = '8px';
    modalImgs.appendChild(img);
  });
  renderComments();
  document.getElementById('postModal').classList.remove('hidden');
}
window.openPostModal = openPostModal;

function closePostModal() {
  document.getElementById('postModal').classList.add('hidden');
  currentPostId = null;
}

// Comments
function renderComments() {
  const posts = getBoardPosts();
  const post = posts.find(p=>p.id===currentPostId);
  const commentList = document.getElementById('commentList');
  commentList.innerHTML = '';
  if(!post || !post.comments.length) {
    commentList.innerHTML = '<div style="color:#aaa;text-align:center;">댓글이 없습니다.</div>';
    return;
  }
  post.comments.forEach(c=>{
    commentList.innerHTML += `<div style="margin-bottom:10px;">
      <strong style="color:#f4978e;font-size:.97em;">${c.name}</strong>
      <div style="margin:4px 0 0 0;white-space:pre-line;">${c.body}</div>
      <div style="color:#bbb;font-size:.85em;">${new Date(c.time).toLocaleString()}</div>
    </div>`;
  });
}

function addComment(event) {
  event.preventDefault();
  if(currentPostId==null) return false;
  const anon = document.querySelector('input[name="commentAnon"]:checked').value === 'yes';
  const name = anon ? '익명' : document.getElementById('commentName').value.trim() || '익명';
  const body = document.getElementById('commentBody').value.trim();
  if(!body) return false;
  if(!anon && !document.getElementById('commentName').value.trim()) {
    alert('이름 또는 닉네임을 입력하세요.');
    return false;
  }
  const posts = getBoardPosts();
  const idx = posts.findIndex(p=>p.id===currentPostId);
  if(idx<0) return false;
  posts[idx].comments.push({
    name,
    body,
    time: new Date().toISOString()
  });
  saveBoardPosts(posts);
  event.target.reset();
  document.getElementById('commentName').style.display = 'none';
  renderComments();
  renderBoardList(boardCurrentPage);
  return false;
}

// Show initial board list on page load if boardSection is activated
document.querySelector('button.menu-btn[onclick*="board"]').addEventListener('click', ()=>renderBoardList(1));
</script>
